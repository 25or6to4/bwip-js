<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="bwip-js : Barcode Writer in Pure JavaScript">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>bwip-js</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/metafloor/bwip-js">View on GitHub</a>

          <h1 id="project_title">bwip-js</h1>
          <h2 id="project_tagline">Barcode Writer in Pure JavaScript</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/metafloor/bwip-js/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/metafloor/bwip-js/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>bwip-js is a translation to native JavaScript of the amazing code provided in <a href="https://github.com/bwipp/postscriptbarcode">Barcode Writer in Pure PostScript</a>.  The translated code can run on any browser that natively supports the HTML canvas element or any JavaScript-based server framework that can implement a minimal bitmap graphics interface.</p>

<p>An online demo of bwip-js that mirrors the functionality of the <a href="http://www.terryburton.co.uk/barcodewriter/generator/">web-based demo</a> provided by BWIPP is now available:<br><br><a href="demo/demo.html">demo</a></p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<p>bwip-js is almost feature complete.  At present, it lacks the following functionality that exists in BWIPP:</p>

<ul>
<li>Only orthogonal scaling is supported.
<li>Rotations of 0, 90, 180, and 270 degrees are supported only in the HTML canvas demo.  There are no plans to implement rotation in the PostScript graphics emulation layer.</li>
<li>Inkspread is currently hard-coded to 0 in the demo.  Setting it to other values may create non-compliant barcodes.</li>
</ul>

<p>bwip-js does <em>not</em> provide a general purpose PostScript emulation layer.  The emulation supports only the PostScript operators used by BWIPP.  The emulation is implemented as a cross-compiler that converts all non-graphics code to equivalent JavaScript, and converts all graphics operations to calls into a platform-neutral graphics context.  It is up to the host environment to implement the bitmap interface that is exposed by the graphics context.  An example implementation is provided in the demo. </p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>You can download the latest package at:</p>

<p><a href="https://github.com/metafloor/bwip-js/releases/latest">https://github.com/metafloor/bwip-js/releases/latest</a></p>

<p>Unzip the download package.  bwip-js will be unpacked into the following directory structure:</p>

<pre><code>bwip-js/
    bwip.js         # Main bwip-js module
    demo.html       # The in-browser demo
	freetype.js		# The emscripten-compiled freetype library.
	freetype.mem.js # Demand loaded memory intializer.
    node-demo       # An example node-js HTTP server application
    node-bwipjs     # A node-js module that implements bwip-js
    bwipp/          # The cross-compiled BWIPP encoders and renderers
    lib/            # Utilities required by the demo
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>bwip-js was designed to run in both client-side and server-side JavaScript environments.  For server-side environments that do not provide a graphics API, there are freely available pure-JavaScript implementations of image file formats like PNG and BMP.  A quick search of the web turns up several possibilities that can be adapted for server-side usage.  See node-bwipjs for an example implementation.</p>

<p>Using bwip-js in your code involves the following steps:</p>

<ul>
<li>Load the main "bwip.js" module.</li>
<li>Implement two host-specific interfaces.</li>
<li>Create a BWIPJS instance and make a barcode.</li>
</ul>

<p>Loading "bwip.js" into your JavaScript environment tends to be very platform specific.  If you are working with a CommonJS architecture, then you will likely need to implement a runtime JavaScript loader.  The node-bwipjs file gives an example implementation for node-js: </p>

<div class="highlight highlight-javascript"><pre><span class="pl-s">var</span> fs <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>fs<span class="pl-pds">'</span></span>);
<span class="pl-s">var</span> vm <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>vm<span class="pl-pds">'</span></span>);

<span class="pl-st">function</span> <span class="pl-en">load</span>(<span class="pl-vpf">path</span>) {
    <span class="pl-s">var</span> text <span class="pl-k">=</span> fs.readFileSync(path);
    <span class="pl-k">if</span> (<span class="pl-k">!</span>text)
        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Error</span>(path <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>: could not read file<span class="pl-pds">"</span></span>);
    vm.runInThisContext(text, path);
}

<span class="pl-c">// Load the primary bwip-js script</span>
<span class="pl-s3">load</span>(<span class="pl-s1"><span class="pl-pds">'</span>bwip.js<span class="pl-pds">'</span></span>);</pre></div>

<p>After bwip.js is loaded and the BWIPJS global is accessible, you must implement two interfaces:</p>

<ul>
<li>Load and execute bwip-js files on demand.  Many of the encoders rely on additional/secondary encoders.  These dependencies are implemented in the PostScript cross-compile as on-demand loading.  Your host implementation must be able to load and execute bwip-js files after the primary encoder has been invoked.  Or you can preload all of the encoders in one shot (that's the strategy the demo takes), but that is a pretty heavy hit every time you generate a barcode.</li>
<li>Provide a bitmap graphics interface.  One gotcha here is that you won't know the size of the bitmap until after the encoders have run.  To make it more interesting, you will routinely see negative values for the x,y coordinates.  Therefore, creating a barcode image is always a two step process.  First run the encoder/renderer and record each pixel's coordinates, along with the min/max values for x and y.  Once the encoder has returned, you can determine the bitmap dimensions and render the final image.</li>
</ul>

<p>Also to keep in mind is that typical graphics environments (HTML canvas, PHP GD, etc.) set their origin (0,0) to the upper left-hand corner.  PostScript uses a page-up orientation and the origin is in the lower left-hand corner.  Since bwip-js implements a direct mapping to the PostScript graphics primitives, the coordinates your bitmap implementation will see have an origin set in the lower left-hand corner.  See the files lib/canvas.js and node-bwipjs for bitmap implementations that convert between the two origin conventions.</p>

<p>Below are the function and object prototypes for the interfaces to implement:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Demand-load encoders, renderers, and fonts.  </span>
<span class="pl-c">// This function is installed as a "class static" method on the bwip-js constructor.</span>
<span class="pl-s3">BWIPJS</span>.<span class="pl-en">load</span> <span class="pl-k">=</span> <span class="pl-st">function</span>(<span class="pl-vpf">path</span>) {
    <span class="pl-c">// path is relative to the bwip-js root directory.  For example, a call to</span>
    <span class="pl-c">// load the one-dimensional barcode renderer will pass the path:</span>
    <span class="pl-c">//      "bwipp/renlinear.js"</span>
    <span class="pl-c">// This implementation must translate the relative path to whatever is</span>
    <span class="pl-c">// required of the server framework and directory structure.</span>
    <span class="pl-c">// bwip-js tracks what has already been loaded (regardless of whether a</span>
    <span class="pl-c">// module was preloaded or demand-loaded).</span>
    <span class="pl-c">// So this interface will only be called when needed.</span>
    ...
}

<span class="pl-c">// The bitmap interface.  bwip-js will only call the color() and set() </span>
<span class="pl-c">// methods during encoding/drawing.  A third method is needed by the </span>
<span class="pl-c">// host code to render the actual barcode image.</span>
<span class="pl-c">// Note that you can name this object class anything you like.  The</span>
<span class="pl-c">// host code is the only one that references it by name.</span>
<span class="pl-st">function</span> <span class="pl-en">Bitmap</span>() {
    <span class="pl-s3">this</span>.<span class="pl-en">color</span> <span class="pl-k">=</span> <span class="pl-st">function</span>(<span class="pl-vpf">r</span>, <span class="pl-vpf">g</span>, <span class="pl-vpf">b</span>) {
        <span class="pl-c">// r,g,b will be integer values between 0 and 255</span>
        <span class="pl-c">// Save as the current color</span>
        ...
    };
    <span class="pl-s3">this</span>.<span class="pl-en">set</span> <span class="pl-k">=</span> <span class="pl-st">function</span>(<span class="pl-vpf">x</span>, <span class="pl-vpf">y</span>) {
        <span class="pl-c">// x,y will be floating point values.  Convert to int.</span>
        x <span class="pl-k">=</span> <span class="pl-s3">Math</span>.<span class="pl-s3">floor</span>(x);
        y <span class="pl-k">=</span> <span class="pl-s3">Math</span>.<span class="pl-s3">floor</span>(y);

        <span class="pl-c">// Save the coordinates and current color</span>
        ...
        <span class="pl-c">// Track the min/max values of x and y</span>
        ...
    };
    <span class="pl-s3">this</span>.<span class="pl-en">render</span> <span class="pl-k">=</span> <span class="pl-st">function</span>( ... ) {
        <span class="pl-c">// This is your code to render the final bitmap image.</span>
        <span class="pl-c">// Width of the bitmap is:  max_x - min_x + 1</span>
        <span class="pl-c">// Height of the bitmap is: max_y - min_y + 1</span>
        <span class="pl-c">// You will need to offset the pixel coordinates by min_x and min_y.</span>
        <span class="pl-c">// And invert the y-axis if the graphics format you are using has its</span>
        <span class="pl-c">// origin in the upper-left corner.</span>
        ...
    };
}</pre></div>

<p>Once the host framework is implemented, it's time to invoke an encoder.  You must remember that this is a PostScript emulation, so the calling conventions have a PostScript feel to them.  </p>

<p>BWIPP (the PostScript library) uses a two-parameter calling convention.  The first parameter is always the barcode text to be encoded.  The second parameter is the options that govern how the barcode is generated.  This second parameter can be either a string or a PostScript dictionary object.  This author recommends using a dictionary object for the options, as they provide more flexibility when working with options values. </p>

<p>One of the standard options available for linear/one-dimensional barcodes is the <code>alttext</code> option.  This option allows overriding what is printed as the human readable component of the barcode.  If the options are specified as a string, no spaces can occur in the <code>alttext</code> value.  This restriction does not exist if a dictionary object is used.</p>

<p>To invoke a barcode encoder/renderer, you do the following steps:</p>

<ul>
<li>Install the host bitmap interface.</li>
<li>Create the dictionary object for the options parameter.</li>
<li>Add the necessary options to the object.</li>
<li>Push the barcode text onto the PostScript operand stack.</li>
<li>Push the options object onto the PostScript operand stack.</li>
<li>Invoke the encoder.  bwip-js will automatically demand load the module, if needed.</li>
</ul>

<p>The following example calls the <code>code128</code> encoder using the <code>parsefnc</code> option to specify the FNC1 character as part of the barcode text, and provides an alternate, human readable text.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a barcode writer instance</span>
<span class="pl-s">var</span> bw <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BWIPJS</span>;

<span class="pl-c">// Create the bitmap interface and pass to the emulator</span>
bw.bitmap(<span class="pl-k">new</span> <span class="pl-en">Bitmap</span>);

<span class="pl-c">// Set the scaling factor</span>
bw.scale(<span class="pl-c1">2</span>, <span class="pl-c1">2</span>);

<span class="pl-c">// Create a dictionary object and set the options</span>
<span class="pl-s">var</span> opts <span class="pl-k">=</span> {};
opts.parsefnc    <span class="pl-k">=</span> bw.<span class="pl-sc">value</span>(<span class="pl-c1">true</span>);
opts.includetext <span class="pl-k">=</span> bw.<span class="pl-sc">value</span>(<span class="pl-c1">true</span>);
opts.alttext     <span class="pl-k">=</span> bw.<span class="pl-sc">value</span>(<span class="pl-s1"><span class="pl-pds">"</span>(00)1234567890<span class="pl-pds">"</span></span>);

<span class="pl-c">// Push the barcode text and options onto the operand stack</span>
bw.<span class="pl-s3">push</span>(<span class="pl-s1"><span class="pl-pds">"</span>^FNC1001234567890<span class="pl-pds">"</span></span>);
bw.<span class="pl-s3">push</span>(opts);

<span class="pl-c">// Invoke the encoder and render the barcode</span>
bw.<span class="pl-s3">call</span>(<span class="pl-s1"><span class="pl-pds">'</span>code128<span class="pl-pds">'</span></span>);
bw.bitmap().render();</pre></div>

<h2>
<a id="nodejs" class="anchor" href="#nodejs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Node.js</h2>

<pre><code>As of March 2015, the node-bwipjs port is not being actively maintained.
I am not a node developer and there are others who are providing npm packages of bwip-js.
</code></pre>

<p>As of bwip-js version 0.8, fully asynchronous, demand-loading of the BWIPP files is now supported.  Included in the bwip-js download is a fully functional Node module that implements a standard HTTP request handler.  The included example server application demonstrates its usage:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-s">var</span> http <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>http<span class="pl-pds">'</span></span>);
<span class="pl-s">var</span> bwipjs <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>./node-bwipjs<span class="pl-pds">'</span></span>);

http.createServer(<span class="pl-st">function</span>(<span class="pl-vpf">req</span>, <span class="pl-vpf">res</span>) {
    <span class="pl-c">// Send all requests to bwip-js.</span>
    <span class="pl-c">// In a real http server, you will want to route requests a bit more</span>
    <span class="pl-c">// intelligently...</span>
    bwipjs(req, res);
}).listen(<span class="pl-c1">3030</span>);</pre></div>

<p>To use the demo Node server, perform the following steps:</p>

<ul>
<li>Install node.js from the <a href="http://nodejs.org">Downloads</a> link.</li>
<li>Download and unzip the latest bwip-js.</li>
<li>Open a terminal window/command prompt and <code>cd</code> to the bwip-js directory.</li>
<li>
<p>Run the demo server:</p>

<p><code>$ node node-demo</code></p>
</li>
</ul>

<p>Once the server is running on your machine, the following link should display a Code 128 bar code in your browser:</p>

<p><a href="http://127.0.0.1:3030/?bcid=code128&amp;text=%5EFNC1011234567890&amp;scale=4&amp;rotate=L&amp;parsefnc&amp;alttext=(01)01234567890">http://127.0.0.1:3030/?bcid=code128&amp;text=^FNC1011234567890&amp;scale=4&amp;rotate=L&amp;parsefnc&amp;alttext=(01)01234567890</a></p>

<p>See the notes in node-bwipjs for details on how to structure the URL for use with the request handler.</p>

<p>The node-bwipjs module provides an example of how to integrate bwip-js into node.js.  It is not production ready.  In particular, the PNG image support is extremely simplistic and will waste a lot of server bandwidth.  256 color depth is used (most bar codes need only two colors) and DEFLATE compression is not implemented.  A native Node implementation of the PNG library with DEFLATE support should greatly reduce image size and CPU utilization.</p>

<h2>
<a id="emulator-notes" class="anchor" href="#emulator-notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Emulator Notes</h2>

<p>The emulation uses, as much as possible, native JavaScript data types.  Specifically, the following are used by the emulation:</p>

<ul>
<li>Boolean values true and false</li>
<li>Null value</li>
<li>Numeric values (integer and float)</li>
<li>Object (PostScript dictionary object)</li>
</ul>

<p>You will note that two of the more common JavaScript data types, strings and arrays, are not on the list.  PostScript implements some very powerful semantics with strings and arrays, namely live views into each data type.  For example, you can have a base array plus other references to the array that are offset views into the array elements.  Each view has its own concept of zero-index and length, but these values may or may not match the base array.  Updates to one view causes the base array to be updated and are visible to all other views of the array.</p>

<p>Similar live-view semantics exist for PostScript strings.  Additionally, strings behave more like arrays of character codes rather than JavaScript's usual string semantics.  (PostScript strings actually behave like Uint8 Typed Arrays; if Typed Arrays ever become common place, we can gain some performance by converting the emulation to use it for strings.  The same cannot be said for arrays, since PostScript arrays can store arbitrary data types, similar to JavaScript.)</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">bwip-js maintained by <a href="https://github.com/metafloor">metafloor</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
